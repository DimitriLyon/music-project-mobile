<!doctype html> <!-- document declaration  -->
<html>
<head>
<link rel="stylesheet" href="style.css">
<!--viewport allows for porper resizing on mobile devices ,K.-->
<meta name="viewport" content="width=device-width, initial-scale=1">


</head>
<body>
    
    <h1 style="color:white">INTERACTIVE MUSIC! </h1>

    <!-- pauses all current tracks -->
    
    <audio id="audioContainer1">
        <source src="audios/Mendelssohn__Octet Excerpt Violin 1.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer2">
        <source src="audios/Mendelssohn__Octet Excerpt Violin 2.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer3">
        <source src="audios/Mendelssohn__Octet Excerpt Violin 3.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer4">
        <source src="audios/Mendelssohn__Octet Excerpt Violin 4.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer5">
        <source src="audios/Mendelssohn__Octet Excerpt Viola 1.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer6">
        <source src="audios/Mendelssohn__Octet Excerpt Viola 2.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer7">
        <source src="audios/Mendelssohn__Octet Excerpt Cello 1.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer8">
        <source src="audios/Mendelssohn__Octet Excerpt Cello 2.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer9">
        <source src="audios/Ex1_sprite_12.03.20-zone9.mp3" type="audio/mpeg">
    </audio>
    <audio id="audioContainer10">
        <source src="audios/Ex1_sprite_12.03.20-zone10.mp3" type="audio/mpeg">
    </audio>
    
    <button type="button" onclick="testMusic()"> START PLAYING</button>
    <button type="button" onClick="connectCtx()" >CONNECT</button><div>
    <!--<button type="button" onClick="pauseAudios()" >PAUSE AUDIO</button>-->
    <!--<button type="button" onClick= "audioContainer1.play()"  >SAFARi</button></div>-->

    <link rel="stylesheet"
        href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" />
   
    <div>
    <div class="container">
        <h1 style="color:white">Track Location: </h1>
        <label class="switch" for="track-me">
            <input id="track-me" type="checkbox" style="display:none;" checked>
            <span class="slider"></span>
            <p class="hide-when-no-tracking" style="color:white">
                latitude: <span id="latitude"></span></br>
                longitude: <span id="longitude"></span></br>
                
                </p>
                </label>
                
    </div>
</div>

<div>
    <!-- Volume Slider  -->
    <h3 style="color:white">Volume slider: </h3>
    <div id="bluebox"></div>

    <div id="holderion">
        <div id="uislider2"></div>
        <div class="color2" style="padding: 0px; background-color: blue;">
            <div id="orange-bg" style="background-color: #FF4500; height:10px;min-width:100%; opacity:0%"></div>
        </div>
        <input type="text2" id="idnumber2" display: none;">
    </div>
    <div id="orangebox"></div>
    <div>

    <!-- Bass Slider  -->
    <h3 style="color:white">Bass slider: </h3>
    <div id="greybox"></div>
    <div id="holderion2">
            <div id="uislider"></div>
            <div class="color" style="padding:0px; background-color: gray;">
                <div id="yellow-bg" style="background-color: yellow; height:10px;min-width:100%; opacity:0%"></div>
            </div>
            <input type="text" id="idnumber" display: none;">
        </div>
        <div id="yellowbox"></div>
    
    </div>
    <!-- treble Slider  -->
    <h3 style="color:white">Treble slider: </h3>
    <div id="greybox"></div>
    <div id="holderion3">
            <div id="uislider3"></div>
            <div class="color" style="padding:0px; background-color: red;">
                <div id="green-bg" style="background-color: rgb(0, 255, 0); height:10px;min-width:100%; opacity:0%"></div>
            </div>
            <input type="text" id="idnumber3" display: none;">
        </div>
        <div id="yellowbox"></div>
    
    </div>
    
    <!--<div> class = "sliderContainer">
        <input type = "range" min="0" max="100" value="50" class="slider" id="myRange">
    </div>-->
    
</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
    <!--<script src="./audioPlayer.js"></script>-->
    <!--<script src="./geoLocate.js"></script>-->
    <script src="./main.js"></script>
    <script src="./zoneOne.js"></script>
    <script src="./zoneTwo.js"></script>
    <script src="./zoneThree.js"></script>
    <script src="./zoneFour.js"></script>
    <script src="./zoneFive.js"></script>

    <!--script below is for testing safari iphone browser.-->
 
<script>
const audio = document.getElementById("audioContainer1");
const audio1 = document.getElementById("audioContainer2");
const audio2 = document.getElementById("audioContainer3");
const audio3 = document.getElementById("audioContainer4");
const audio4 = document.getElementById("audioContainer5");
const audio5 = document.getElementById("audioContainer6");
const audio6 = document.getElementById("audioContainer7");
const audio7 = document.getElementById("audioContainer8");
const audio8 = document.getElementById("audioContainer9");
const audio9 = document.getElementById("audioContainer10");

var ctxConnected = false;
var inzone = 0;
function connectCtx(){
    if(ctxConnected){
        console.log("audio contexts already initialized");
    }
    else if(!ctxConnected){

        window.AudioContext ? new AudioContext() : webkitAudioContext();
        ctx = new AudioContext();
        ctx1 = new AudioContext();
        ctx2 = new AudioContext();
        ctx3 = new AudioContext();
        ctx4 = new AudioContext();
        ctx5 = new AudioContext();
        ctx6 = new AudioContext();
        ctx7 = new AudioContext();
        ctx8 = new AudioContext();
        ctx9 = new AudioContext();

        var audioSource1 = ctx.createMediaElementSource(audio);
        var audioSource2 = ctx1.createMediaElementSource(audio1);
        var audioSource3 = ctx2.createMediaElementSource(audio2);
        var audioSource4 = ctx3.createMediaElementSource(audio3);
        var audioSource5 = ctx4.createMediaElementSource(audio4);
        var audioSource6 = ctx5.createMediaElementSource(audio5);
        var audioSource7 = ctx6.createMediaElementSource(audio6);
        var audioSource8 = ctx7.createMediaElementSource(audio7);
        var audioSource9 = ctx8.createMediaElementSource(audio8);
        var audioSource10 = ctx9.createMediaElementSource(audio9);

        // lowshelf nodes

        bassFilter = ctx.createBiquadFilter();
        bassFilter.type = "lowshelf";
        bassFilter.frequency.value = 200; 

        bassFilter1 = ctx1.createBiquadFilter();
        bassFilter1.type = "lowshelf";
        bassFilter1.frequency.value = 200; 

        bassFilter2 = ctx2.createBiquadFilter();
        bassFilter2.type = "lowshelf";
        bassFilter2.frequency.value = 200;

        bassFilter3 = ctx3.createBiquadFilter();
        bassFilter3.type = "lowshelf";
        bassFilter3.frequency.value = 200; 

        bassFilter4 = ctx4.createBiquadFilter();
        bassFilter4.type = "lowshelf";
        bassFilter4.frequency.value = 200;

        bassFilter5 = ctx5.createBiquadFilter();
        bassFilter5.type = "lowshelf";
        bassFilter5.frequency.value = 200;

        bassFilter6 = ctx6.createBiquadFilter();
        bassFilter6.type = "lowshelf";
        bassFilter6.frequency.value = 200;

        bassFilter7 = ctx7.createBiquadFilter();
        bassFilter7.type = "lowshelf";
        bassFilter7.frequency.value = 200;

        bassFilter8 = ctx8.createBiquadFilter();
        bassFilter8.type = "lowshelf";
        bassFilter8.frequency.value = 200;
        
        bassFilter9 = ctx9.createBiquadFilter();
        bassFilter9.type = "lowshelf";
        bassFilter9.frequency.value = 200;
        
        // highself nodes


        trebleFilter = ctx.createBiquadFilter();
        trebleFilter.type = "highshelf"; 
        trebleFilter.frequency.value = 2000;

        trebleFilter1 = ctx1.createBiquadFilter();
        trebleFilter1.type = "highshelf"; 
        trebleFilter1.frequency.value = 2000;

        trebleFilter2 = ctx2.createBiquadFilter();
        trebleFilter2.type = "highshelf"; 
        trebleFilter2.frequency.value = 2000;

        trebleFilter3 = ctx3.createBiquadFilter();
        trebleFilter3.type = "highshelf"; 
        trebleFilter3.frequency.value = 2000;

        trebleFilter4 = ctx4.createBiquadFilter();
        trebleFilter4.type = "highshelf"; 
        trebleFilter4.frequency.value = 2000;

        trebleFilter5 = ctx5.createBiquadFilter();
        trebleFilter5.type = "highshelf"; 
        trebleFilter5.frequency.value = 2000;

        trebleFilter6 = ctx6.createBiquadFilter();
        trebleFilter6.type = "highshelf"; 
        trebleFilter6.frequency.value = 2000;

        trebleFilter7 = ctx7.createBiquadFilter();
        trebleFilter7.type = "highshelf"; 
        trebleFilter7.frequency.value = 2000;

        trebleFilter8 = ctx8.createBiquadFilter();
        trebleFilter8.type = "highshelf"; 
        trebleFilter8.frequency.value = 2000;

        trebleFilter9 = ctx9.createBiquadFilter();
        trebleFilter9.type = "highshelf"; 
        trebleFilter9.frequency.value = 2000;

        //connected nodes
        audioSource1.connect(bassFilter);
        bassFilter.connect(trebleFilter); 
        trebleFilter.connect(ctx.destination);

        audioSource2.connect(bassFilter1);
        bassFilter1.connect(trebleFilter1); 
        trebleFilter1.connect(ctx1.destination);

        audioSource3.connect(bassFilter2);
        bassFilter2.connect(trebleFilter2); 
        trebleFilter2.connect(ctx2.destination);

        audioSource4.connect(bassFilter3);
        bassFilter3.connect(trebleFilter3); 
        trebleFilter3.connect(ctx3.destination);

        audioSource5.connect(bassFilter4);
        bassFilter4.connect(trebleFilter4); 
        trebleFilter4.connect(ctx4.destination);

        audioSource6.connect(bassFilter5);
        bassFilter5.connect(trebleFilter5); 
        trebleFilter5.connect(ctx5.destination);

        audioSource7.connect(bassFilter6);
        bassFilter6.connect(trebleFilter6); 
        trebleFilter6.connect(ctx6.destination);

        audioSource8.connect(bassFilter7);
        bassFilter7.connect(trebleFilter7); 
        trebleFilter7.connect(ctx7.destination);

        audioSource9.connect(bassFilter8);
        bassFilter8.connect(trebleFilter8); 
        trebleFilter8.connect(ctx8.destination);

        audioSource10.connect(bassFilter9);
        bassFilter9.connect(trebleFilter9); 
        trebleFilter9.connect(ctx9.destination);
        
        ctxConnected = true;
    }
}

audio.loop = true;
audio1.loop = true;
audio2.loop = true;
audio3.loop = true;
audio4.loop = true;
audio5.loop = true;
audio6.loop = true;
audio7.loop = true;
audio8.loop = true;
audio9.loop = true;

/* audio.play();
audio1.play();
audio2.play();
audio3.play();
audio4.play(); */

audio.volume = 0;
audio1.volume = 0;
audio2.volume = 0;
audio3.volume = 0;
audio4.volume = 0;
audio5.volume = 0;
audio6.volume = 0;
audio7.volume = 0;
audio8.volume = 0;
audio9.volume = 0;  

//play and loop all audios

// function determines if coordinates are inside a polygon.
function inside(point, vs) {
    // ray-casting algorithm based on
    // https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html/pnpoly.html
    
    var x = point[0], y = point[1];
    
    var inside = false;
    for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
        var xi = vs[i][0], yi = vs[i][1];
        var xj = vs[j][0], yj = vs[j][1];
        
        var intersect = ((yi > y) != (yj > y))
            && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
        if (intersect) inside = !inside;
    }
    
    return inside;
}

const zone_one = new zoneOne();
const zone_two = new zoneTwo();
const zone_three = new zoneThree();
const zone_four = new zoneFour();
const zone_five = new zoneFive();

const zone_six = new zoneSix();
const zone_seven = new zoneSeven();
const zone_eight = new zoneEight();
const zone_nine = new zoneNine();
const zone_ten = new zoneTen();

var verZoneOne = [
    [zone_one.get_first_lat, zone_one.get_first_lng],
    [zone_one.get_second_lat, zone_one.get_second_lng],
    [zone_one.get_third_lat, zone_one.get_third_lng],
    [zone_one.get_fourth_lat, zone_one.get_fourth_lng]
];

var verZoneTwo = [
    [zone_two.get_first_lat, zone_two.get_first_lng],
    [zone_two.get_second_lat, zone_two.get_second_lng],
    [zone_two.get_second_lng, zone_two.get_third_lng]
];

var verZoneThree = [
    [zone_three.get_first_lat, zone_three.get_first_lng],
    [zone_three.get_second_lat, zone_three.get_second_lng],
    [zone_three.get_third_lat, zone_three.get_third_lng]
];

var verZoneFour = [
    [zone_four.get_first_lat, zone_four.get_first_lng],
    [zone_four.get_second_lat, zone_four.get_second_lng],
    [zone_four.get_third_lat, zone_four.get_third_lng],
    [zone_four.get_fourth_lat, zone_four.get_fourth_lng]
];

var verZoneFive = [
    [zone_five.get_first_lat, zone_five.get_first_lng],
    [zone_five.get_second_lat, zone_five.get_second_lng],
    [zone_five.get_third_lat, zone_five.get_third_lng],
    [zone_five.get_fourth_lat, zone_five.get_fourth_lng]
];

// function handles the logic of the zones in the map.
function testMusic(){
    
    updated = getLocation();

    lat = updated.latitude;
    lng = updated.longitude;

    console.log(lat);
    console.log(lng);

    if(inside([lat, lng],verZoneOne)){
        console.log("In location 1");
        audio.play();
        audio.volume = 1;
    } 
    else{
        console.log("Not in location 1");
        audio.volume = 0; 
    }
    if(inside([lat, lng],verZoneTwo)){
        console.log("In location 2");
        audio1.play();
        audio1.volume = 1;
    } 
    else{
        console.log("Not in location 2");
        audio1.volume = 0; 
    }
    if(inside([lat, lng],verZoneThree)){
        console.log("In location 3");
        audio2.play();
        audio2.volume = 1;
    } 
    else{
        console.log("Not in location 3");
        audio2.volume = 0; 
    }
    if(inside([lat, lng],verZoneFour)){
        console.log("In location 4");
        audio3.play();
        audio3.volume = 1;
    } 
    else{
        console.log("Not in location 4");
        audio3.volume = 0; 
    }
    if(inside([lat, lng],verZoneFive)){
        console.log("In location 5");
        audio4.play();
        audio4.volume = 1;
    } 
    else{
        console.log("Not in location 5");
        audio4.volume = 0; 
    }
    
}

var coordinates = {};

async function showLocation(position) {
    // obtain coordinates from the API.
    var lat = position.coords.latitude;
    var lng = position.coords.longitude;
    // coordinates stores new coordinates.
    coordinates = {latitude: lat, longitude: lng};
    // print into the HTML file.
    document.getElementById('latitude').textContent = lat;
    document.getElementById('longitude').textContent = lng;
    
    // POST request to server.
    const options = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(coordinates)
    };
    const response = await fetch('/', options);
}

function errorHandler(err) {
    if(err.code == 1) {
        alert("Error: Access is denied!");
    } else if( err.code == 2) {
        alert("Error: Position is unavailable!");
    }
}
//no request for iOS
//https://stackoverflow.com/questions/48293914/geolocation-in-javascript-on-ios-safari
function getLocation() {
    if(navigator.geolocation) {
       // timeout at 60000 milliseconds (60 seconds)
       var options = {timeout:60000};
       navigator.geolocation.getCurrentPosition(showLocation, errorHandler, options);
       // return the updated variables.
       return coordinates;
    } else {
       alert("Sorry, browser does not support geolocation!");
    }
}

</script>
</body>
</html>